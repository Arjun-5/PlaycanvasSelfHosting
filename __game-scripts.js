var CustomAvatarLoader=pc.createScript("customAvatarLoader");CustomAvatarLoader.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),CustomAvatarLoader.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),CustomAvatarLoader.attributes.add("LoadAvatarBtn",{type:"entity"}),CustomAvatarLoader.attributes.add("LoadingScreen",{type:"entity"}),CustomAvatarLoader.instance=null,window.addEventListener("message",(function(t){"https://rarerooms.readyplayer.me"===t.origin&&CustomAvatarLoader.instance.LoadNewAvatar(t.data)}),!1),CustomAvatarLoader.prototype.initialize=function(){if(CustomAvatarLoader.instance=this,this.GlbURL=null,this.iframeWidth=window.innerWidth,this.iframeHeight=window.innerHeight,this.app.on("BtnManager:LoadAvatarButtonClick",this.customAvatarSelection.bind(this)),this.on("destroy",function(){this.app.off("BtnManager:LoadAvatarButtonClick",this.customAvatarSelection.bind(this))}.bind(this)),this.setupIframe(),this.isMobile=!1,pc.platform.mobile||pc.platform.android||pc.platform.ios){let t=document.getElementById("avatarIframe");t.style.width=this.iframeWidth+"px",t.style.height=this.iframeHeight+"px",t.style.border="none",this.isMobile=!0}else{let t=document.getElementById("avatarIframe");t.style.width="900px",t.style.height="650px",t.style.border="none",this.isMobile=!1}},CustomAvatarLoader.prototype.LoadNewAvatar=function(t){let e=document.getElementById("avatarIframe"),a=document.getElementById("avatarDiv");e.style.display="none",a.style.display="none",this.loadGLBModelFromURL(t)},CustomAvatarLoader.prototype.loadGLBModelFromURL=function(t){this.GlbURL=t,this.app.fire("LoadingMenu:SetLoading",!0,"Loading Avatar..");let e="model_"+Math.floor(1e4*Math.random()),a=t+"?cacheBuster="+Math.floor(1e4*Math.random());this.LoadingScreen.enabled=!0,utils.loadGlbContainerFromUrl(a,null,e,function(t,e){e.resources[0].model?this.app.root.findByName("Model").model.asset=e.resources[0].model.id:console.log(e.resources),this.LoadAvatarBtn.enabled=!0,this.LoadingScreen.enabled=!1}.bind(this))},CustomAvatarLoader.prototype.setupIframe=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.id="avatarDiv",this.div.classList.add("avatarContrainer"),this.div.innerHTML=this.html.resource||"",this.div.style.display="none";document.getElementById("application-canvas");document.body.appendChild(this.div)},CustomAvatarLoader.prototype.customAvatarSelection=function(){this.LoadAvatarBtn.enabled=!1;let t=document.getElementById("avatarIframe"),e=document.getElementById("avatarDiv");t.src="https://rarerooms.readyplayer.me/avatar",t.style.display="block",e.style.display="block"},CustomAvatarLoader.prototype.update=function(t){};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.attributes.add("Main Camera",{type:"entity"}),PlayerMovement.prototype.initialize=function(){var e=this.app.root.findByName("Camera");this.cameraScript=e.script.cameraMovement,this.force=new pc.Vec3,this.forceX=new pc.Vec3,this.forceZ=new pc.Vec3,this.app.on("thirdPersonMovementSpeed",this.changePlayerSpeed.bind(this)),this.on("destroy",function(){this.app.off("thirdPersonMovementSpeed")}.bind(this))},PlayerMovement.prototype.changePlayerSpeed=function(){this.speed=this.speed+.02},PlayerMovement.prototype.update=function(e){var t=this.app;this.force=pc.Vec3.ZERO.clone();var i=this.entity.forward,r=this.entity.right;if((t.keyboard.isPressed(pc.KEY_A)||t.keyboard.isPressed(pc.KEY_LEFT))&&(this.force.x-=r.x,this.force.z-=r.z),(t.keyboard.isPressed(pc.KEY_D)||t.keyboard.isPressed(pc.KEY_RIGHT))&&(this.force.x+=r.x,this.force.z+=r.z),(t.keyboard.isPressed(pc.KEY_W)||t.keyboard.isPressed(pc.KEY_UP))&&(this.force.x+=i.x,this.force.z+=i.z),(t.keyboard.isPressed(pc.KEY_S)||t.keyboard.isPressed(pc.KEY_DOWN))&&(this.force.x-=i.x,this.force.z-=i.z),this.forceX.copy(this.entity.right).scale(this.cameraScript.velX*this.speed),this.forceZ.copy(this.entity.forward).scale(-this.cameraScript.velZ*this.speed),this.cameraScript.LTouch&&(this.force=this.forceX.add(this.forceZ).normalize().scale(80)),0!==this.force.x||0!==this.force.z){var s=new pc.Vec3(this.force.x*e,0,this.force.z*e);s.normalize().scale(this.speed),s.add(this.entity.getPosition());var c=this.cameraScript.eulers.x+180,o=new pc.Vec3(0,c,0);this.entity.rigidbody.teleport(s,o)}};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.attributes.add("touchSensitivity",{type:"number",default:5,description:"Touch Sensitivity"}),CameraMovement.attributes.add("player",{type:"entity",description:"Main Character"}),CameraMovement.attributes.add("rotationSensitivity",{type:"number",default:300,description:"Rotation Sensitivity"}),CameraMovement.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity",description:""});const isDebug=!1;CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2,this.lmbDown=!1,this.moved=!1,this.touchAction=!1,this.rightRotation=!1;var t=this.entity.getLocalRotation();this.ex=this.getPitch(t)*pc.math.RAD_TO_DEG,this.ey=this.getYaw(t)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey;var e=this.app;this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this);var i=e.graphicsDevice.canvas;function lockChangeAlert(){document.pointerLockElement===i||document.mozPointerLockElement}"onpointerlockchange"in document?document.addEventListener("pointerlockchange",lockChangeAlert,!0):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",lockChangeAlert,!0),this.lastLTouchPoint=new pc.Vec2,this.LTouchStartPoint=new pc.Vec2,this.LTouch=null,this.Rid=-1,this.Lid=-1,this.velZ=0,this.velX=0,this.rayEnd=e.root.findByName("RaycastEndPoint"),e.touch&&(e.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),e.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),e.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),e.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.on("destroy",function(){this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART),this.app.touch.off(pc.EVENT_TOUCHEND),this.app.touch.off(pc.EVENT_TOUCHCANCEL),this.app.touch.off(pc.EVENT_TOUCHMOVE)),this.app.mouse.off("mousedown"),this.app.mouse.off("mousemove"),"onpointerlockchange"in document?document.removeEventListener("pointerlockchange",lockChangeAlert,!1):"onmozpointerlockchange"in document&&document.removeEventListener("mozpointerlockchange",lockChangeAlert,!1)}.bind(this))},CameraMovement.prototype.onKeyUp=function(t){t.key!==pc.KEY_E&&t.key!==pc.KEY_Q||(this.keyboardRotation=!1)},CameraMovement.prototype.onKeyDown=function(t){this.app.keyboard.isPressed(pc.KEY_Q)?(this.keyboardRotation=!0,this.rightRotation=!1):this.app.keyboard.isPressed(pc.KEY_E)&&(this.keyboardRotation=!0,this.rightRotation=!0)},CameraMovement.prototype.getYaw=function(t){var e=t,i=e.x*e.x,o=e.y*e.y;return Math.atan2(2*e.y*e.w-2*e.z*e.x,1-2*o-2*i)},CameraMovement.prototype.getPitch=function(t){var e=t;return-Math.asin(2*e.z*e.y+2*e.x*e.w)},CameraMovement.prototype.update=function(t){this.velZ=-1!=this.Lid?this.lastLTouchPoint.y-this.LTouchStartPoint.y:0,this.velX=-1!=this.Lid?this.lastLTouchPoint.x-this.LTouchStartPoint.x:0},CameraMovement.prototype.postUpdate=function(t){if(this.touchAction){var e=this.entity.parent,i=this.eulers.x+180,o=this.eulers.y,s=new pc.Vec3(-o,i,0);this.player.setLocalEulerAngles(0,i,0),e.setEulerAngles(s),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(e.getPosition())}else this.ex=pc.math.lerp(this.ex,this.targetEx,t/.2),this.keyboardRotation?(this.rightRotation?this.targetEy-=5*this.rotationSensitivity:this.targetEy+=5*this.rotationSensitivity,this.ey=pc.math.lerp(this.ey,this.targetEy,t/.2)):this.ey=pc.math.lerp(this.ey,this.targetEy,t/.2),this.player.setLocalEulerAngles(0,this.ey+180,0),this.entity.parent.setLocalEulerAngles(this.ex,0,0),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(this.entity.parent.getPosition())},CameraMovement.prototype.moveCamera=function(t,e,i){this.moved?(this.targetEx+=e*i,this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy+=t*i):this.moved=!0},CameraMovement.prototype.onMouseMove=function(t){this.lmbDown&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},CameraMovement.prototype.onMouseDown=function(t){0===t.button&&(this.lmbDown=!0,this.touchAction=!1)},CameraMovement.prototype.onMouseUp=function(t){0===t.button&&(this.lmbDown=!1)},CameraMovement.prototype.onTouchStart=function(t){t.changedTouches.forEach((function(t){var e=this.app.graphicsDevice;this.touchAction=!0,t.x>.5*e.width/window.devicePixelRatio&&-1==this.Rid&&(this.Rid=t.id,this.touchCoords.set(t.x,t.y)),t.x<=.5*e.width/window.devicePixelRatio&&-1==this.Lid&&(this.Lid=t.id,this.LTouchStartPoint.set(t.x,t.y),this.lastLTouchPoint.set(t.x,t.y))}),this)},CameraMovement.prototype.onTouchEnd=function(t){t.changedTouches.forEach((function(t){this.Rid==t.id&&(this.Rid=-1),this.Lid==t.id&&(this.Lid=-1)}),this)},CameraMovement.prototype.onTouchMove=function(t){if(this.RTouch=t.getTouchById(this.Rid,t.touches),this.LTouch=t.getTouchById(this.Lid,t.touches),this.touchAction=!0,this.RTouch){var e=(this.RTouch.x-this.touchCoords.x)*this.touchSensitivity,i=(this.RTouch.y-this.touchCoords.y)*this.touchSensitivity;this.eulers.x-=this.touchSensitivity*e/60%360,this.eulers.y+=this.touchSensitivity*i/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360),this.touchCoords.set(this.RTouch.x,this.RTouch.y)}this.LTouch&&this.lastLTouchPoint.set(this.LTouch.x,this.LTouch.y)},CameraMovement.prototype.getWorldPoint=function(){var t=this.entity.parent.getPosition(),e=this.rayEnd.getPosition(),i=this.app.systems.rigidbody.raycastFirst(t,e);return i?i.point:e};var PlayerAnimationHandler=pc.createScript("playerAnimationHandler");PlayerAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),PlayerAnimationHandler.attributes.add("velMin",{type:"number",default:10}),PlayerAnimationHandler.attributes.add("velMax",{type:"number",default:50}),PlayerAnimationHandler.prototype.initialize=function(){var i=this.app,t=i.root.findByName("Camera");this.cameraScript=t.script.cameraMovement,i.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),i.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.on("destroy",function(){this.app.keyboard.off(pc.EVENT_KEYDOWN),this.app.keyboard.off(pc.EVENT_KEYUP)}.bind(this)),this.direction="Idle",this.setDirection("Idle")},PlayerAnimationHandler.prototype.update=function(i){if(this.cameraScript.LTouch){var t=this.direction;this.checkTouch(),t!==this.direction&&this.setDirection(this.direction)}},PlayerAnimationHandler.prototype.checkButtons=function(){var i=this.app,t=i.keyboard.isPressed(pc.KEY_W)||i.keyboard.isPressed(pc.KEY_UP),e=i.keyboard.isPressed(pc.KEY_A)||i.keyboard.isPressed(pc.KEY_LEFT),a=i.keyboard.isPressed(pc.KEY_S)||i.keyboard.isPressed(pc.KEY_DOWN),r=i.keyboard.isPressed(pc.KEY_D)||i.keyboard.isPressed(pc.KEY_RIGHT);this.direction=t&&!a?e&&!r?"JogForwardLeft":r&&!e?"JogForwardRight":"Walking":a&&!t?e&&!r?"JogBackwardLeft":r&&!e?"JogBackwardRight":"WalkBack":e&&!r?"WalkLeft":r&&!e?"WalkRight":"Idle"},PlayerAnimationHandler.prototype.checkTouch=function(){this.app;this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX<-this.velMax?this.direction="JogForwardLeft":this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX>this.velMax?this.direction="JogForwardRight":this.cameraScript.velZ<0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="Walking":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX<-this.velMax?this.direction="JogBackwardLeft":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX>this.velMax?this.direction="JogBackwardRight":this.cameraScript.velZ>0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="WalkBack":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX<-this.velMin?this.direction="WalkLeft":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX>this.velMin?this.direction="WalkRight":this.direction="Idle"},PlayerAnimationHandler.prototype.keyChange=function(i){var t=this.direction;this.checkButtons(),t!==this.direction&&this.setDirection(this.direction)},PlayerAnimationHandler.prototype.setDirection=function(i){this.direction=i,this.entity.animation.play(i,this.blendTime)};var MyEnum={LoadAvatar:1};class ButtonManager extends pc.ScriptType{onButtonClick(){if(1===this.Choices)this.LoadAvatar()}initialize(){this.entity.element.on("mousedown",this.onRelease,this),this.entity.button&&(this.entity.button.on("hoverstart",this.hoverStart,this),this.entity.button.on("hoverend",this.hoverEnd,this)),this.app.touch&&this.entity.element.on("touchend",this.onTouchDown,this)}hoverStart(t){document.body.style.cursor="pointer"}hoverEnd(t){document.body.style.cursor="auto"}onPressedDown(t){this.pointerDown=!0}onMove(t){this.pointerDown=!1}onRelease(t){t.stopPropagation(),this.onButtonClick(),this.pointerDown=!1,this.app.fire("sound:playSound","Btnclick")}onTouchDown(t){this.onButtonClick(),this.pointerDown=!1,this.app.fire("sound:playSound","Btnclick")}LoadAvatar(){this.app.fire("BtnManager:LoadAvatarButtonClick")}}function mapEnum(t){var n={},o=[];for(var e in t)if(t.hasOwnProperty(e)){var i={};i[e]=t[e],o.push(i),n[t[e]]=e}return t.toString=function(t){return n[t]},o}pc.registerScript(ButtonManager,"buttonManager"),ButtonManager.attributes.add("Choices",{type:"number",enum:mapEnum(MyEnum)});!function(){var e={},r=pc.Application.getApplication();e.loadGlbContainerFromAsset=function(e,r,t,n){var o=new Blob([e.resource]),a=URL.createObjectURL(o);return this.loadGlbContainerFromUrl(a,r,t,(function(e,r){n(e,r),URL.revokeObjectURL(a)}))},e.loadGlbContainerFromUrl=function(e,t,n,o){var a=n+".glb",l={url:e,filename:a},s=new pc.Asset(a,"container",l,null,t);return s.tags.add(a),s.once("load",(function(e){if(o){var r=e.resource.animations;if(1==r.length)r[0].name=n;else if(r.length>1)for(var t=0;t<r.length;++t)r[t].name=n+" "+t.toString();for(let r=0;r<e.resource.materials.length;r++)e.resource.materials[r].tags.add(a);for(let r=0;r<e.resource.textures.length;r++)e.resource.textures[r].tags.add(a);o(null,e)}})),r.assets.add(s),r.assets.load(s),s},e.wrapAngle360=function(e){return e%360},e.cloneTexture=function(e){var r=new pc.Texture(e.device,e);return r._levels=function(e){for(var r=[],t=0;t<e._levels.length;++t){var n=[];if(e.cubemap)for(var o=0;o<6;++o)n.push(e._levels[t][o]);else n=e._levels[t];r.push(n)}return r}(e),r},e.cloneTextureAsset=function(r){var t=new pc.Asset(r.name,r.type,r.file,r.data,r.options);return t.loaded=!0,t.resource=e.cloneTexture(r.resource),r.registry.add(t),t},window.utils=e}();var TweenRotation=pc.createScript("tweenRotation");TweenRotation.attributes.add("RotationSpeed",{type:"number"}),TweenRotation.prototype.initialize=function(){},TweenRotation.prototype.update=function(t){var e=this.entity.getLocalEulerAngles().x,n=this.entity.getLocalEulerAngles().y,i=this.entity.getLocalEulerAngles().z-this.RotationSpeed*t;this.entity.setLocalEulerAngles(e,n,i)};var Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Ui.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"";var e=document.createElement("div");e.classList.add("container-fluid"),e.style.position="relative",e.style.width="100%",e.style.height="100%",e.innerHTML=this.html.resource||"",document.body.appendChild(e),twttr.widgets.load()};var TouchCameraMovement=pc.createScript("touchCameraMovement");TouchCameraMovement.attributes.add("touchSensitivity",{type:"number",default:5,description:"Touch Sensitivity"}),TouchCameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var t=this.app;this.canvas=this.app.graphicsDevice,this.rayEnd=t.root.findByName("RaycastEndPoint"),this.lastRTouchPoint=new pc.Vec2,this.Rid=-1,this.dx=null,this.dy=null,this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)},TouchCameraMovement.prototype.postUpdate=function(t){var i=this.entity.parent,o=this.eulers.x+180,h=this.eulers.y,s=new pc.Vec3(-h,o,0);i.setEulerAngles(s),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(i.getPosition())},TouchCameraMovement.prototype.getWorldPoint=function(){var t=this.entity.parent.getPosition(),i=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(t,i);return o?o.point:i},TouchCameraMovement.prototype.onTouchStart=function(t){t.changedTouches.forEach((function(t){t.x>this.canvas.width/2&&-1==this.Rid&&(this.Rid=t.id,this.lastRTouchPoint.set(t.x,t.y))}),this)},TouchCameraMovement.prototype.onTouchEndCancel=function(t){t.changedTouches.forEach((function(t){t.id==this.Rid&&(this.Rid=-1)}),this)},TouchCameraMovement.prototype.onTouchMove=function(t){this.RTouch=t.getTouchById(this.Rid,t.touches),this.RTouch&&(this.dx=(this.RTouch.x-this.lastRTouchPoint.x)*this.touchSensitivity,this.dy=(this.RTouch.y-this.lastRTouchPoint.y)*this.touchSensitivity,this.eulers.x-=this.touchSensitivity*this.dx/60%360,this.eulers.y+=this.touchSensitivity*this.dy/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360),this.lastRTouchPoint.set(this.RTouch.x,this.RTouch.y))};var TouchPlayerMovement=pc.createScript("touchPlayerMovement");TouchPlayerMovement.attributes.add("speed",{type:"number",default:.09}),TouchPlayerMovement.prototype.initialize=function(){var t=this.app.root.findByName("Camera");this.canvas=this.app.graphicsDevice,this.cameraScript=t.script.touchCameraMovement,this.lastLTouchPoint=new pc.Vec2,this.LTouchStartPoint=new pc.Vec2,this.Lid=-1,this.LTouch=null,this.velZ=0,this.velX=0,this.Force=new pc.Vec3,this.forceX=new pc.Vec3,this.forceZ=new pc.Vec3,this.direction="Idle",this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)},TouchPlayerMovement.prototype.onTouchStart=function(t){t.changedTouches.forEach((function(t){t.x<this.canvas.width/2&&-1==this.Lid&&(this.Lid=t.id,this.LTouchStartPoint.set(t.x,t.y),this.lastLTouchPoint.set(t.x,t.y))}),this)},TouchPlayerMovement.prototype.onTouchEndCancel=function(t){t.changedTouches.forEach((function(t){t.id==this.Lid&&(this.Lid=-1)}),this)},TouchPlayerMovement.prototype.onTouchMove=function(t){this.LTouch=t.getTouchById(this.Lid,t.touches),this.LTouch&&this.lastLTouchPoint.set(this.LTouch.x,this.LTouch.y)},TouchPlayerMovement.prototype.update=function(t){this.app;if(this.direction="Idle",-1!=this.Lid){this.velZ=(this.lastLTouchPoint.y-this.LTouchStartPoint.y)*this.speed,this.velX=(this.lastLTouchPoint.x-this.LTouchStartPoint.x)*this.speed,this.velZ<0&&this.velX<3&&this.velX>-3?this.direction="Walking":this.velZ<-3&&this.velX>3?this.direction="WalkRight":this.velZ<-3&&this.velX<-3?this.direction="WalkLeft":this.velZ>0&&this.velX<3&&this.velX>-3&&(this.direction="WalkBack"),this.Force=new pc.Vec3,this.forceX.copy(this.entity.right).scale(this.velX),this.forceZ.copy(this.entity.forward).scale(-this.velZ),this.Force.add2(this.forceX,this.forceZ).normalize().scale(80);var i=new pc.Vec3(this.Force.x*t,0,this.Force.z*t);i.normalize().scale(this.speed),i.add(this.entity.getPosition());var e=this.cameraScript.eulers.x+180,h=new pc.Vec3(0,e,0);this.entity.rigidbody.teleport(i,h)}};var TouchPlayerAnimationHandler=pc.createScript("touchPlayerAnimationHandler");TouchPlayerAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),TouchPlayerAnimationHandler.prototype.initialize=function(){var t=this.app;this.setDirection("Idle");var i=t.root.findByName("Player");this.touchPlayerMovementScript=i.script.touchPlayerMovement,this.direction=this.touchPlayerMovementScript.direction},TouchPlayerAnimationHandler.prototype.update=function(t){var i=this.direction;this.direction=this.touchPlayerMovementScript.direction,i!==this.direction&&this.setDirection(this.direction)},TouchPlayerAnimationHandler.prototype.setDirection=function(t){this.direction=t,this.entity.animation.play(t,this.blendTime)};var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture.attributes.add("videoUrl",{title:"Video Url",description:"URL to use if there is video asset selected",type:"string"}),VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!0;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.play()}.bind(this)),t.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load(),this.on("destroy",(function(){this.videoTexture.destroy(),t.remove()}),this)},VideoTexture.prototype.update=function(e){this.videoTexture.upload()};var TvScreen=pc.createScript("tvScreen");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.emissiveMap=e,t.update()}),this)};var ImageCover=pc.createScript("imageCover");ImageCover.attributes.add("originalWidth",{type:"number"}),ImageCover.attributes.add("originalHeight",{type:"number"}),ImageCover.prototype.initialize=function(){this.app.graphicsDevice.on("resizecanvas",this.onResize,this),this.onResize(this.app.graphicsDevice.width,this.app.graphicsDevice.height)},ImageCover.prototype.onResize=function(e,t){e>t?(this.entity.element.height=e/1e3*1e3,this.entity.element.width=e):(this.entity.element.width=t/1e3*1e3,this.entity.element.height=t)};var LoadingAnimation=pc.createScript("loadingAnimation"),currentTimer=0,dotCount=0;LoadingAnimation.prototype.initialize=function(){},LoadingAnimation.prototype.update=function(t){(currentTimer+=t)>.5&&(this.entity.element.text+=".",dotCount++,currentTimer=0,5==dotCount&&(dotCount=0,this.entity.element.text="Data Loading"))};var jsonData,VaryconDataLoader=pc.createScript("varyconDataLoader");VaryconDataLoader.attributes.add("jsonFile",{type:"asset",assetType:"json"});const token="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2NjYyNjA5NzUsImNvbnRlbnQiOiJlSnc5elRFT3dqQU1CZEM3ZUc1UlVWTUVuV0JoZ3dIQmhCaWN4S0dCSkVWT00xU29keWNnWVBTei8vY1RVaVNHOWdrYnBmb1VodE4zdEJwYVdFZ1V1cW5yVXRUS2xFSm9WYTdJcUxLU1prNU50YXlydVlJQ2pPVTQ3TkZUamh5d1N5NmJ3ejhkT3d4WFpMeGxKby9XWmVQMzJacEo5YXdsampOTmVTbGRyKzZVSHh0MGtRcXdIcSswdFk3Q3B5Z2s1d3J3NUNWeDdPd2pRbnUrRkJESE9KRGZhRzhEdEFNbit0RU9RODd6dDI2YXBoZDZXay9SIn0.WDJC2m9vSx1q0oVGS5MkW4NhBdEA7dIDySOOkYoEXM4";function httpRequestVarycon(){pc.http.post("https://stage.varycon.com/api/schema/4dd2ecb7-9c48-4567-9021-bd88c631125e",this.jsonFile,{headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer "+token}},(function(e,t){console.log("The response is :"+t),console.log(e)}))}async function fetchVaryconData(){const e=await fetch("https://stage.varycon.com/api/schema/4dd2ecb7-9c48-4567-9021-bd88c631125e",{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer "+token},body:this.jsonFile});try{jsonData=await e.text()}catch(e){alert(e)}return jsonData}async function readAllChunks(e){const t=e.getReader(),a=[];let o,n;for(;!o;){if(({value:n,done:o}=await t.read()),o)return a;a.push(n)}}function requestToVarycon(){var e=new XMLHttpRequest;e.open("POST","https://stage.varycon.com/api/schema/4dd2ecb7-9c48-4567-9021-bd88c631125e"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept","*/*"),e.setRequestHeader("Authorization","Bearer"+token),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(alert(e.responseText),console.log("The result is ",e.responseText))},e.send(this.jsonFile)}VaryconDataLoader.prototype.initialize=async function(){console.log("The Json File",this.jsonFile),console.log("The result is :",await fetchVaryconData())},VaryconDataLoader.prototype.update=function(e){};var VaryconDataLoading=pc.createScript("varyconDataLoading");VaryconDataLoading.attributes.add("jsonFile",{type:"asset",assetType:"json"});const mytoken="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2NjYyNjA5NzUsImNvbnRlbnQiOiJlSnc5elRFT3dqQU1CZEM3ZUc1UlVWTUVuV0JoZ3dIQmhCaWN4S0dCSkVWT00xU29keWNnWVBTei8vY1RVaVNHOWdrYnBmb1VodE4zdEJwYVdFZ1V1cW5yVXRUS2xFSm9WYTdJcUxLU1prNU50YXlydVlJQ2pPVTQ3TkZUamh5d1N5NmJ3ejhkT3d4WFpMeGxKby9XWmVQMzJacEo5YXdsampOTmVTbGRyKzZVSHh0MGtRcXdIcSswdFk3Q3B5Z2s1d3J3NUNWeDdPd2pRbnUrRkJESE9KRGZhRzhEdEFNbit0RU9RODd6dDI2YXBoZDZXay9SIn0.WDJC2m9vSx1q0oVGS5MkW4NhBdEA7dIDySOOkYoEXM4";function onChunkedResponseComplete(e){console.log("all done!",e)}function onChunkedResponseError(e){console.error(e)}function processChunkedResponse(e){var n="",o=e.body.getReader(),t=new TextDecoder;return readChunk();function readChunk(){return o.read().then(appendChunks)}function appendChunks(e){var o=t.decode(e.value||new Uint8Array,{stream:!e.done});return console.log("got chunk of",o.length,"bytes"),n+=o,console.log("text so far is",n.length,"bytes\n"),e.done?(console.log("returning"),n):(console.log("recursing"),readChunk())}}VaryconDataLoading.prototype.initialize=function(){fetch("https://stage.varycon.com/api/schema/4dd2ecb7-9c48-4567-9021-bd88c631125e",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+mytoken},body:this.jsonFile}).then(processChunkedResponse).then(onChunkedResponseComplete).then((e=>{console.log(e),e.json()})).then((e=>console.log(e))).catch(onChunkedResponseError)},VaryconDataLoading.prototype.update=function(e){};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var FadingObject=pc.createScript("fadingObject");FadingObject.attributes.add("duration",{type:"number",default:2,title:"Duration (Secs)"}),FadingObject.attributes.add("name",{type:"string",array:!0}),FadingObject.attributes.add("render",{type:"entity",default:null}),FadingObject.attributes.add("gameConfig",{type:"json",schema:[{name:"numEnemies",type:"number",default:10},{name:"enemyModels",type:"asset",assetType:"model",array:!0},{name:"godMode",type:"boolean",default:!1}]}),FadingObject.prototype.initialize=function(){this.time=0;var t=this.entity.findComponents("render");this.meshInstances=[];for(var e=0;e<t.length;++e)for(var a=t[e].meshInstances,i=0;i<a.length;i++)this.meshInstances.push(a[i])},FadingObject.prototype.update=function(t){this.time+=t,this.time>this.duration&&(this.time-=this.duration);for(var e=this.time/this.duration,a=Math.abs(2*(e-.5)),i=this.meshInstances,n=0;n<i.length;++n)i[n].setParameter("material_opacity",a)};var ButtonLogic=pc.createScript("buttonLogic");ButtonLogic.attributes.add("ImageContentElement",{type:"entity"}),ButtonLogic.attributes.add("ImageContent",{type:"entity"}),ButtonLogic.attributes.add("CameraEntity",{type:"entity"}),ButtonLogic.attributes.add("TextureAsset",{type:"asset",assetType:"texture"}),ButtonLogic.attributes.add("TextEntity",{type:"entity"}),ButtonLogic.prototype.initialize=function(){this.entity.button.on("click",(function(t){console.log("The object name is ",this.entity.name),this.ImageContentElement.enabled=!0,this.ImageContent.element.textureAsset=this.TextureAsset,this.TextEntity.element.text="This is a test message"}),this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onSelect,this),touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this)}),this)},ButtonLogic.prototype.update=function(t){},ButtonLogic.prototype.onSelect=function(t){console.log("The object name is ",this.entity.name),this.ImageContentElement.enabled=!0,this.ImageContent.element.textureAsset=this.TextureAsset,this.TextEntity.element.text="This is a test message"},ButtonLogic.prototype.onTouchStart=function(t){this.ImageContentElement.enabled=!0,this.ImageContent.element.textureAsset=this.TextureAsset},ButtonLogic.ray=new pc.Ray,ButtonLogic.hitPosition=new pc.Vec3,ButtonLogic.prototype.doRayCast=function(t){var e=ButtonLogic.ray,n=ButtonLogic.hitPosition;this.CameraEntity.camera.screenToWorld(t.x,t.y,this.CameraEntity.camera.nearClip,e.origin),this.CameraEntity.camera.screenToWorld(t.x,t.y,this.CameraEntity.camera.farClip,e.direction),e.direction.sub(e.origin).normalize(),"FirstButton"==this.groundShape.intersectsRay(e,n).entity.name&&console.log("The button pressed is First Button")};var CloseImageContent=pc.createScript("closeImageContent");CloseImageContent.attributes.add("ImageContentElement",{type:"entity"}),CloseImageContent.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.ImageContentElement.enabled=!1}),this)},CloseImageContent.prototype.update=function(t){};pc.script.createLoadingScreen((async function(e){var o,t;o=["body {","    background-color: #484848;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #ffffff;","}","","#application-splash {","    position: absolute;","    top: calc(50% + 56px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-logo {","   position: absolute;","    top: calc(50% - 112px);","    left: calc(50% - 240px);","    width: 480px;","  text-align: center;","}","","#application-logo img {","    width: 100%;","}","","#application-splash img {","    width: 100%;","}","","#rb-logo{","   position: absolute;","    right: 10px;","    width: 180px;","    bottom: 10px;","}","","#rb-logo img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #00cca3;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(t=document.createElement("style")).type="text/css",t.styleSheet?t.styleSheet.cssText=o:t.appendChild(document.createTextNode(o)),document.head.appendChild(t);var a=await async function fetchVaryconData(){var e;console.log("Json File",'{"query": "{ workspaces { playCanvas { contentTemplates { showRoom { contents { data { mainRoomContent { showRoomHeaders { elements { value } } companyLogo { value { publicUrl } } showRoomImages { elements { value { publicUrl } } } showRoomVideos { elements { value { publicUrl } } } } } } } } } }}"}');const o=await fetch("https://phoenix.recordbay.de/data",{method:"GET",headers:{"Content-Type":"text/plain",Accept:"*/*"}});try{e=await o.text()}catch(e){alert(e)}return e}();console.log("The json data is ",a),function(e){var o=JSON.parse(e).data.workspaces.playCanvas.contentTemplates.showRoom.contents[0].data.mainRoomContent.companyLogo.value.publicUrl,t=document.createElement("div");t.id="application-splash-wrapper",document.body.appendChild(t);var a=document.createElement("div");a.id="application-splash",t.appendChild(a),a.style.display="none";var n=document.createElement("img");n.id="application-logo",n.src=o,t.appendChild(n),n.onload=function(){a.style.display="block"};var p=document.createElement("div");p.id="progress-bar-container",a.appendChild(p);var l=document.createElement("div");l.id="progress-bar",p.appendChild(l);var i=document.createElement("img");i.id="rb-logo",i.src="https://www.dl.dropboxusercontent.com/s/oib8pieyommejac/Recordbay_Logo.svg",t.appendChild(i),i.onload=function(){a.style.display="block"}}(a),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var o=document.getElementById("progress-bar");o&&(e=Math.min(1,Math.max(0,e)),o.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var PointAndClick=pc.createScript("pointAndClick");PointAndClick.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),PointAndClick.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),PointAndClick.attributes.add("playerSpeed",{type:"number",default:0,title:"Player Speed"}),PointAndClick.prototype.initialize=function(){this.groundShape=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(4,.001,4)),this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this)}),this)},PointAndClick.newPosition=new pc.Vec3,PointAndClick.prototype.update=function(t){if(this.direction.lengthSq()>0){var i=this.playerSpeed*t,e=PointAndClick.newPosition;e.copy(this.direction).scale(i),e.add(this.playerEntity.getPosition()),this.playerEntity.setPosition(e),this.distanceToTravel-=i,this.distanceToTravel<=0&&(this.playerEntity.setPosition(this.targetPosition),this.direction.set(0,0,0))}},PointAndClick.prototype.movePlayerTo=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.playerEntity.getPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.playerEntity.getPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.playerEntity.lookAt(this.targetPosition)):this.direction.set(0,0,0)},PointAndClick.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&this.doRayCast(t)},PointAndClick.prototype.onTouchStart=function(t){1==t.touches.length&&(this.doRayCast(t.touches[0]),t.event.preventDefault())},PointAndClick.ray=new pc.Ray,PointAndClick.hitPosition=new pc.Vec3,PointAndClick.prototype.doRayCast=function(t){var i=PointAndClick.ray,e=PointAndClick.hitPosition;this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.nearClip,i.origin),this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip,i.direction),i.direction.sub(i.origin).normalize();var n=this.entity.getPosition(),o=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip),s=this.app.systems.rigidbody.raycastFirst(n,o);if(s){var a=s.entity;"Boden_Ground_Collider"==a.name&&(console.log("The clicked object is ",a.name),this.movePlayerTo(e))}};var ControllerDrag=pc.createScript("controllerDrag");ControllerDrag.prototype.initialize=function(){},ControllerDrag.prototype.update=function(e){},ControllerDrag.attributes.add("player",{type:"entity",title:"player"}),ControllerDrag.attributes.add("handle",{type:"entity",title:"handle"}),ControllerDrag.attributes.add("bg",{type:"entity",title:"handle background"}),ControllerDrag.prototype.postInitialize=function(){var e=this.player,t=(this.app,this),a=this.handle,r=this.bg,l=(this.bg.getLocalPosition().clone(),a.getLocalPosition().clone()),o=r.element.height/2;this.handleDragHelper=new pc.ElementDragHelper(this.handle.element),t.handleDragHelper.on("drag:move",(function(a){var r=a.x,l=a.y;this.dx=t.handleDragHelper._deltaHandlePosition.x,this.dy=t.handleDragHelper._deltaHandlePosition.y;var n=Math.sqrt(this.dx*this.dx+this.dy*this.dy);if(n>o){var i=this.dx/n,d=this.dy/n;r=i*o,l=d*o,t.handleDragHelper._deltaHandlePosition.x=r,t.handleDragHelper._deltaHandlePosition.y=l,t.entity.setLocalPosition(t.handleDragHelper._deltaHandlePosition)}e?(e.script.playerMovement.SetMovingTo(!0),e.script.playerMovement.forceX=t.handleDragHelper._deltaHandlePosition.x,e.script.playerMovement.forceY=t.handleDragHelper._deltaHandlePosition.y):console.warn("No player found!")})),t.handleDragHelper.on("drag:end",(function(t){a.setLocalPosition(l),e&&(e.script.playerMovement.SetMovingTo(!1),e.script.playerMovement.StopMovement())}))},ControllerDrag.prototype.update=function(e){};var ActivateJoystick=pc.createScript("activateJoystick");ActivateJoystick.attributes.add("lftController",{type:"entity",title:"Left Controller"}),ActivateJoystick.attributes.add("rgtController",{type:"entity",title:"Right Controller"}),ActivateJoystick.attributes.add("loadAvatar",{type:"entity",title:"Load Avatar"}),ActivateJoystick.prototype.initialize=function(){this.app.touch&&(this.lftController.enabled=!0,this.rgtController.enabled=!0,this.rgtController.enabled=!0)},ActivateJoystick.prototype.update=function(t){},ActivateJoystick.prototype.onKeyDown=function(t){t.key==pc.KEY_L&&(1==this.loadAvatar.enabled?this.loadAvatar.enabled=!1:this.loadAvatar.enabled=!0)};var UiControlInfo=pc.createScript("uiControlInfo");UiControlInfo.attributes.add("UIControl",{type:"entity"}),UiControlInfo.attributes.add("UIInfoKeyboard",{type:"entity"}),UiControlInfo.attributes.add("UIInfoKeyboardTouch",{type:"entity"}),UiControlInfo.attributes.add("UIInfoTouch",{type:"entity"}),UiControlInfo.prototype.initialize=function(){pc.platform.desktop&&this.app.touch?this.UIInfoKeyboardTouch.enabled=!0:pc.platform.ios||pc.platform.android||pc.platform.mobile?this.UIInfoTouch.enabled=!0:pc.platform.desktop&&(this.UIInfoKeyboard.enabled=!0),this.entity.button.on("click",(function(t){this.UIControl.enabled=!0}),this)},UiControlInfo.prototype.update=function(t){};